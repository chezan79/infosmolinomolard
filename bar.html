<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bar - Planning</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Includi PDF.js tramite CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
     <!-- Open Graph tags -->
  
</head>
<body>
    <header>
        <h1>Planning Bar</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
            </ul>
        </nav>
    </header>
<main>
  <section>
    <h2>Planning hebdomadaire</h2>
    <ul>
      <li>
        <a href="https://drive.google.com/file/d/1SLNgQCB3ZXopTxLk1CWP--PNxvTEzLS-/view?usp=drivesdk" target="_blank">Planning semaine en cours</a>
      </li>
      <li>
        <a href="https://drive.google.com/file/d/1VcXwl2xULtHb1ISHiSGytSczMW2tpHDV/view?usp=sharing" target="_blank">Planning prochaine semaine</a>
      </li>
    </ul>
  </section>

  <section>
    <h2>Planning Mensuel</h2>
    <ul>
      <li>
        <a href="https://drive.google.com/file/d/1CsEbQtyK26sO1XkKOVWgJ0FEFPM7zal8/view?usp=sharing" target="_blank">Planning du mois en cours</a>
      </li>
      <li>
        <a href="https://drive.google.com/file/d/1pIfNK2fbHp2OIewRLHaibCLC9bURh59p/view?usp=sharing" target="_blank">Planning du mois prochain</a>
      </li>
    </ul>
  </section>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estrattore Planning</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <h1>Estrattore Planning</h1>
  
  <label for="personSelect">Seleziona Persona:</label>
  <select id="personSelect">
    <option value="">-- Seleziona --</option>
  </select>

  <div id="result"></div>

  <script>
    // Costanti
    const EXCEL_FILE_ID = "INSERISCI_L_ID_DEL_FILE"; // Sostituisci con l'ID del file Excel
    const DAYS = ["Lu", "Ma", "Me", "Je", "Ve", "Sa", "Di"]; // Intestazioni dei giorni in formato abbreviato

    // Funzione per ottenere il link diretto di download di un file Excel su Google Drive
    function getDriveDownloadUrl(fileId) {
      return `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=YOUR_API_KEY`; // Sostituisci YOUR_API_KEY con la tua chiave API
    }

    // Funzione per leggere un file Excel e restituire i dati
    async function readExcelFromDrive(fileId) {
      try {
        const url = getDriveDownloadUrl(fileId);
        console.log("Scaricamento file da:", url); // Debug
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`Errore HTTP: ${response.status}`);
        }
        const data = await response.arrayBuffer(); // Ottieni i dati binari del file
        const workbook = XLSX.read(data, { type: "array" }); // Leggi il file Excel
        const sheetName = workbook.SheetNames[0]; // Usa il primo foglio
        const sheet = workbook.Sheets[sheetName];
        return XLSX.utils.sheet_to_json(sheet); // Converte il foglio in un array di oggetti
      } catch (error) {
        console.error("Errore durante la lettura del file Excel:", error);
        throw error;
      }
    }

    // Funzione per popolare il menu a discesa con i nomi delle persone
    function populatePersonSelect(data) {
      const personSelect = document.getElementById("personSelect");
      data.forEach(row => {
        if (row["Nome"]) { // Assicurati che la colonna "Nome" esista
          const option = document.createElement("option");
          option.value = row["Nome"];
          option.textContent = row["Nome"];
          personSelect.appendChild(option);
        }
      });
    }

    // Funzione per mostrare il planning di una persona selezionata
    function showPersonPlanning(data, person) {
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = ""; // Svuota il contenuto precedente

      const personData = data.find(row => row["Nome"] === person);
      if (!personData) {
        resultDiv.textContent = "Nessun dato trovato per la persona selezionata.";
        return;
      }

      // Crea una tabella per mostrare il planning
      const table = document.createElement("table");
      table.border = "1";
      const thead = document.createElement("thead");
      thead.innerHTML = `
        <tr>
          <th>Giorno</th>
          <th>Orario</th>
        </tr>
      `;
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      DAYS.forEach(day => {
        const row = document.createElement("tr");
        const dayCell = document.createElement("td");
        dayCell.textContent = day;
        const timeCell = document.createElement("td");
        timeCell.textContent = personData[day] || "Nessun orario"; // Mostra l'orario o un messaggio vuoto
        row.appendChild(dayCell);
        row.appendChild(timeCell);
        tbody.appendChild(row);
      });
      table.appendChild(tbody);

      resultDiv.appendChild(table);
    }

    // Inizializzazione
    async function init() {
      try {
        // Leggi i dati dal file Excel
        const data = await readExcelFromDrive(EXCEL_FILE_ID);
        console.log("Dati letti dal file Excel:", data); // Debug

        // Popola il menu a discesa con i nomi delle persone
        populatePersonSelect(data);

        // Aggiungi un listener per il cambio di selezione
        const personSelect = document.getElementById("personSelect");
        personSelect.addEventListener("change", () => {
          const selectedPerson = personSelect.value;
          if (selectedPerson) {
            showPersonPlanning(data, selectedPerson);
          }
        });
      } catch (error) {
        console.error("Errore durante l'inizializzazione:", error);
        document.getElementById("result").textContent = "Errore durante il caricamento del file.";
      }
    }

    // Avvia l'applicazione
    init();
  </script>
</body>
</html>
