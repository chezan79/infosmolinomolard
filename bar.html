<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bar - Planning</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Includi PDF.js tramite CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
     <!-- Open Graph tags -->
  
</head>
<body>
    <header>
        <h1>Planning Bar</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
            </ul>
        </nav>
    </header>
<main>
  <section>
    <h2>Planning hebdomadaire</h2>
    <ul>
      <li>
        <a href="https://drive.google.com/file/d/1SLNgQCB3ZXopTxLk1CWP--PNxvTEzLS-/view?usp=drivesdk" target="_blank">Planning semaine en cours</a>
      </li>
      <li>
        <a href="https://drive.google.com/file/d/1VcXwl2xULtHb1ISHiSGytSczMW2tpHDV/view?usp=sharing" target="_blank">Planning prochaine semaine</a>
      </li>
    </ul>
  </section>

  <section>
    <h2>Planning Mensuel</h2>
    <ul>
      <li>
        <a href="https://drive.google.com/file/d/1CsEbQtyK26sO1XkKOVWgJ0FEFPM7zal8/view?usp=sharing" target="_blank">Planning du mois en cours</a>
      </li>
      <li>
        <a href="https://drive.google.com/file/d/1pIfNK2fbHp2OIewRLHaibCLC9bURh59p/view?usp=sharing" target="_blank">Planning du mois prochain</a>
      </li>
    </ul>
  </section>

  <!-- ðŸ”Ž Estrazione planning per persona -->
  <section>
    <h2>Estrai planning per persona</h2>

   <form id="extract-form" style="display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end;">
  <label>
    <span>Persona</span><br />
    <select id="person-select" required>
      <option value="">-- Seleziona --</option>
    </select>
  </label>

  <label>
    <span>Settimana</span><br />
    <select id="week-select">
      <option value="current">Semaine en cours</option>
      <option value="next">Prochaine semaine</option>
    </select>
  </label>

  <button type="submit">Estrai</button>
</form>

<div id="status"></div>
<div id="result"></div>


    <div id="status" aria-live="polite" style="margin-top:10px;"></div>
    <div id="result" style="margin-top:16px;"></div>
  </section>

  <!-- Canvas di anteprima PDF (opzionale) -->
  <section>
    <h2>Anteprima</h2>
    <canvas id="pdf-canvas"></canvas>
  </section>
</main>
<script>
    // Costanti
    const EXCEL_FILE_ID = "1sLzplaAa0npps1Km8zCwnp7y0CCJVP_F"; // ID della cartella o file (modifica con l'ID del file Excel)
    const DAYS = ["LunedÃ¬", "MartedÃ¬", "MercoledÃ¬", "GiovedÃ¬", "VenerdÃ¬", "Sabato", "Domenica"];

    // Funzione per ottenere il link diretto di download di un file Excel su Google Drive
    function getDriveDownloadUrl(fileId) {
      return `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=YOUR_API_KEY`;
    }

    // Funzione per leggere un file Excel e restituire i dati
    async function readExcelFromDrive(fileId) {
      const url = getDriveDownloadUrl(fileId);
      const response = await fetch(url);
      const data = await response.arrayBuffer(); // Ottieni i dati binari del file
      const workbook = XLSX.read(data, { type: "array" }); // Leggi il file Excel
      const sheetName = workbook.SheetNames[0]; // Usa il primo foglio
      const sheet = workbook.Sheets[sheetName];
      return XLSX.utils.sheet_to_json(sheet); // Converte il foglio in un array di oggetti
    }

    // Funzione per popolare il menu a discesa con i nomi delle persone
    function populatePersonSelect(data) {
      const personSelect = document.getElementById("personSelect");
      data.forEach(row => {
        const option = document.createElement("option");
        option.value = row["Nome"]; // Supponendo che la colonna A abbia l'intestazione "Nome"
        option.textContent = row["Nome"];
        personSelect.appendChild(option);
      });
    }

    // Funzione per mostrare il planning di una persona selezionata
    function showPersonPlanning(data, person) {
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = ""; // Svuota il contenuto precedente

      const personData = data.find(row => row["Nome"] === person);
      if (!personData) {
        resultDiv.textContent = "Nessun dato trovato per la persona selezionata.";
        return;
      }

      // Crea una tabella per mostrare il planning
      const table = document.createElement("table");
      table.border = "1";
      const thead = document.createElement("thead");
      thead.innerHTML = `
        <tr>
          <th>Giorno</th>
          <th>Orario</th>
        </tr>
      `;
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      DAYS.forEach(day => {
        const row = document.createElement("tr");
        const dayCell = document.createElement("td");
        dayCell.textContent = day;
        const timeCell = document.createElement("td");
        timeCell.textContent = personData[day] || "Nessun orario"; // Mostra l'orario o un messaggio vuoto
        row.appendChild(dayCell);
        row.appendChild(timeCell);
        tbody.appendChild(row);
      });
      table.appendChild(tbody);

      resultDiv.appendChild(table);
    }

    // Inizializzazione
    async function init() {
      try {
        // Leggi i dati dal file Excel
        const data = await readExcelFromDrive(EXCEL_FILE_ID);

        // Popola il menu a discesa con i nomi delle persone
        populatePersonSelect(data);

        // Aggiungi un listener per il cambio di selezione
        const personSelect = document.getElementById("personSelect");
        personSelect.addEventListener("change", () => {
          const selectedPerson = personSelect.value;
          if (selectedPerson) {
            showPersonPlanning(data, selectedPerson);
          }
        });
      } catch (error) {
        console.error("Errore durante il caricamento del file Excel:", error);
        document.getElementById("result").textContent = "Errore durante il caricamento del file.";
      }
    }

    // Avvia l'applicazione
    init();
  </script>
</body>
</html>
